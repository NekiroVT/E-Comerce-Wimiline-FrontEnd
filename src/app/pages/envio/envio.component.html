<div class="envio-container">

  <!-- ğŸš© Paso 1: SelecciÃ³n de tipo -->
  <div *ngIf="modo === 'seleccion'" class="opciones-envio">
  <h3>Â¿CÃ³mo quieres tu envÃ­o?</h3>
  <div class="grupo-botones">
    <button (click)="elegirDomicilio()">EnvÃ­o a Domicilio</button>
    <button (click)="elegirTolva()">EnvÃ­o a Tolva</button>
  </div>
</div>


  <!-- ğŸš© Paso 2: Lista de direcciones -->
  <div *ngIf="modo === 'domicilio'" class="lista-direcciones">
    <h3>Elige tu direcciÃ³n de entrega</h3>

    <button (click)="nuevaDireccion()">â• Nueva DirecciÃ³n</button>

    <div *ngIf="direcciones.length === 0">
      <p>No tienes direcciones registradas.</p>
    </div>

    <div *ngFor="let dir of direcciones" class="direccion-card">
      <label class="direccion-item">
        <input
          type="radio"
          name="direccion"
          [value]="dir.id"
          [(ngModel)]="direccionSeleccionadaId" />
        <span class="direccion-text">
          {{ dir.direccion }} â€” {{ dir.referencia }}
        </span>
        <button type="button" (click)="verEnMapa(dir)">ğŸ—ºï¸ Ver Mapa</button>
      </label>
    </div>

    <button (click)="confirmarDireccion()" [disabled]="!direccionSeleccionadaId">
      Continuar con esta direcciÃ³n
    </button>
  </div>

  <!-- ğŸš© Paso 3: Formulario para crear -->
  <!-- ğŸš© Paso 3: Formulario para crear -->
<div *ngIf="modo === 'crear'" class="form-direccion">
  <h3>Crear Nueva DirecciÃ³n</h3>

  <form [formGroup]="formDireccion" (ngSubmit)="guardarDireccion()">

    <label>DirecciÃ³n
      <input formControlName="direccion" placeholder="Ej: Jr. Los Olivos 123" />
    </label>

    <!-- ğŸš« CÃ³digo Postal YA NO SE MUESTRA -->
    <!-- ğŸš« Latitud YA NO SE MUESTRA -->
    <!-- ğŸš« Longitud YA NO SE MUESTRA -->

    <label>Referencia
      <input formControlName="referencia" placeholder="Ej: Puerta azul" />
    </label>

    <label>Destinatario
      <input formControlName="destinatario" placeholder="Ej: Elias Crack" />
    </label>

    <button type="button" (click)="abrirSelectorUbicacion()">
      ğŸ“ {{ formDireccion.value.latitud && formDireccion.value.longitud ? 'Cambiar UbicaciÃ³n' : 'Elegir UbicaciÃ³n' }}
    </button>

    <button type="submit" [disabled]="formDireccion.invalid">Guardar DirecciÃ³n</button>

  </form>
</div>


  <!-- ğŸš© Paso 4: Vista de mapa para ver -->
  <div *ngIf="modo === 'ver-mapa'" class="ver-mapa-container">
    <app-mapa
      [latitud]="direccionAMostrarEnMapa.latitud"
      [longitud]="direccionAMostrarEnMapa.longitud"
      [direccion]="direccionAMostrarEnMapa.direccion">
    </app-mapa>

    <button class="btn-volver" (click)="volverALista()">â¬…ï¸ Volver</button>
  </div>

  <!-- ğŸš© Paso 5: Selector de ubicaciÃ³n -->
  <div *ngIf="modo === 'elegir-ubicacion'" class="selector-ubicacion-container">
    <h3>Selecciona la UbicaciÃ³n</h3>

    <google-map
      height="400px"
      width="100%"
      [center]="center"
      [zoom]="15"
      (mapClick)="marcarUbicacion($event)">
      <map-marker *ngIf="markerPosition" [position]="markerPosition"></map-marker>
    </google-map>

    <button (click)="confirmarUbicacion()">âœ… Confirmar UbicaciÃ³n</button>
    <button (click)="cerrarSelectorUbicacion()">âŒ Cancelar</button>
  </div>

</div>
