
<link
  rel="stylesheet"
  href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"
/>

<div class="container">
  <!-- ðŸ§­ Cabecera -->
  <app-top-bar></app-top-bar>
  <app-navbar></app-navbar>

  <!-- ðŸ“¦ Contenido del producto -->
  <div class="detalle-container" *ngIf="producto">
    <!-- ðŸ“¸ GalerÃ­a principal -->
    <div class="galeria">
      <img class="imagen-principal" [src]="imagenSeleccionada" alt="Producto" />
      <div class="miniaturas">
        <img *ngFor="let img of todasLasImagenes" [src]="img.urlImagen" class="miniatura"
          (click)="imagenSeleccionada = img.urlImagen" [class.activa]="imagenSeleccionada === img.urlImagen" />
      </div>
    </div>

    <!-- ðŸ§¾ Info producto -->
    <div class="info-producto">
      <h2>{{ producto.nombre }}</h2>
      <p class="descripcion">{{ producto.descripcion }}</p>

      <!-- ðŸ“‚ CategorÃ­as -->
      <div class="seccion" *ngIf="producto.categorias?.length">
        <strong>CategorÃ­as:</strong>
        <ul>
          <li *ngFor="let cat of producto.categorias">ðŸ“‚ {{ cat }}</li>
        </ul>
      </div>

      <!-- ðŸ”§ Especificaciones -->
      <div class="seccion" *ngIf="producto.especificaciones?.length">
        <strong>Especificaciones:</strong>
        <ul>
          <li *ngFor="let esp of producto.especificaciones">
            ðŸ”§ {{ esp.clave }}: {{ esp.valor }}
          </li>
        </ul>
      </div>

      <!-- ðŸ’° Mostrar precio y stock seleccionados -->
<div class="seccion precio-stock" *ngIf="precioActual !== null && stockActual !== null">
  <div class="precio-stock-box">
    <div class="info-item">
  <i class="fas fa-coins icon-precio"></i>
  <strong>Precio:</strong> S/. {{ precioActual }}
</div>
<div class="info-item">
  <i class="fas fa-boxes-stacked icon-stock"></i>
  <strong>Stock:</strong> {{ stockActual }}
</div>

  </div>
</div>


      <!-- ðŸŽ›ï¸ Atributos agrupados -->
      <div class="seccion" *ngIf="valoresPorClave">
        <ng-container *ngFor="let clave of clavesDisponibles">
          <div class="atributo">
            <strong>{{ clave }} :</strong>
            <button *ngFor="let valor of valoresPorClave[clave]" class="valor-btn"
              [class.seleccionado]="valoresSeleccionados[clave] === valor" (click)="seleccionarValor(clave, valor)">
              {{ valor }}
            </button>
          </div>
        </ng-container>
      </div>

      <!-- ðŸ›’ Selector de cantidad -->
<div class="seccion cantidad-carrito" *ngIf="stockActual !== null && stockActual > 0">
  <strong>Cantidad:</strong>

  <!-- Si ya estÃ¡ en el carrito: mostrar control -->
  <div *ngIf="itemExistente; else botonAgregar" class="cantidad-control">
    <button (click)="disminuirCantidad()" [disabled]="cantidadSeleccionada <= 1">âˆ’</button>

    <select [(ngModel)]="cantidadSeleccionada" (change)="onCantidadCambiada()">
      <option *ngFor="let n of cantidadOpciones" [value]="n">{{ n }}</option>
    </select>

    <button (click)="aumentarCantidad()" [disabled]="cantidadSeleccionada >= stockActual">+</button>

    <button class="ir-carrito" routerLink="/carrito">
      <i class="fas fa-shopping-cart"></i> Ir al carrito
    </button>
  </div>

  <!-- Si NO estÃ¡ en el carrito: mostrar botÃ³n AÃ±adir -->
  <ng-template #botonAgregar>
    <select [(ngModel)]="cantidadSeleccionada" class="cantidad-selector">
      <option *ngFor="let n of cantidadOpciones" [value]="n">{{ n }}</option>
    </select>

    <button class="btn-carrito" (click)="agregarAlCarrito()">
      <i class="fas fa-cart-plus"></i> AÃ±adir
    </button>
  </ng-template>
</div>



      <!-- ðŸ’° Mostrar precio y stock seleccionados -->
      
    </div>
  </div>

  <!-- ðŸ”„ Cargando -->
  <div *ngIf="!producto" class="cargando">
    ðŸ”„ Cargando producto...
  </div>
</div>